function ElizaBot(e){this.noRandom=!!e,this.capitalizeFirstLetter=!0,this.debug=!1,this.memSize=20,this.version="1.1 (original)",this._dataParsed||this._init(),this.reset()}ElizaBot.prototype.reset=function(){this.quit=!1,this.mem=[],this.lastchoice=[];for(var e=0;e<elizaKeywords.length;e++){this.lastchoice[e]=[];for(var t=elizaKeywords[e][2],i=0;i<t.length;i++)this.lastchoice[e][i]=-1}},ElizaBot.prototype._dataParsed=!1,ElizaBot.prototype._init=function(){var e=ElizaBot.prototype.global=self,t={};if(e.elizaSynons&&"object"==typeof elizaSynons)for(var i in elizaSynons)t[i]="("+i+"|"+elizaSynons[i].join("|")+")";e.elizaKeywords&&void 0!==elizaKeywords.length||(elizaKeywords=[["###",0,[["###",[]]]]]);for(var s=/@(\S+)/,r=/(\S)\s*\*\s*(\S)/,o=/^\s*\*\s*(\S)/,a=/(\S)\s*\*\s*$/,n=/^\s*\*\s*$/,l=/\s+/g,h=0;h<elizaKeywords.length;h++){var p=elizaKeywords[h][2];elizaKeywords[h][3]=h;for(i=0;i<p.length;i++){var z=p[i];if("$"==z[0].charAt(0)){for(var f=1;" "==z[0].charAt[f];)f++;z[0]=z[0].substring(f),z[2]=!0}else z[2]=!1;for(var g=s.exec(z[0]);g;){var u=t[g[1]]?t[g[1]]:g[1];z[0]=z[0].substring(0,g.index)+u+z[0].substring(g.index+g[0].length),g=s.exec(z[0])}if(n.test(z[0]))z[0]="\\s*(.*)\\s*";else{if(g=r.exec(z[0])){for(var c="",y=z[0];g;)c+=y.substring(0,g.index+1),")"!=g[1]&&(c+="\\b"),c+="\\s*(.*)\\s*","("!=g[2]&&"\\"!=g[2]&&(c+="\\b"),c+=g[2],y=y.substring(g.index+g[0].length),g=r.exec(y);z[0]=c+y}if(g=o.exec(z[0])){c="\\s*(.*)\\s*";")"!=g[1]&&"\\"!=g[1]&&(c+="\\b"),z[0]=c+z[0].substring(g.index-1+g[0].length)}if(g=a.exec(z[0])){c=z[0].substring(0,g.index+1);"("!=g[1]&&(c+="\\b"),z[0]=c+"\\s*(.*)\\s*"}}z[0]=z[0].replace(l,"\\s+"),l.lastIndex=0}}if(elizaKeywords.sort(this._sortKeywords),ElizaBot.prototype.pres={},ElizaBot.prototype.posts={},e.elizaPres&&elizaPres.length){var m=new Array;for(i=0;i<elizaPres.length;i+=2)m.push(elizaPres[i]),ElizaBot.prototype.pres[elizaPres[i]]=elizaPres[i+1];ElizaBot.prototype.preExp=new RegExp("\\b("+m.join("|")+")\\b")}else ElizaBot.prototype.preExp=/####/,ElizaBot.prototype.pres["####"]="####";if(e.elizaPosts&&elizaPosts.length){for(m=new Array,i=0;i<elizaPosts.length;i+=2)m.push(elizaPosts[i]),ElizaBot.prototype.posts[elizaPosts[i]]=elizaPosts[i+1];ElizaBot.prototype.postExp=new RegExp("\\b("+m.join("|")+")\\b")}else ElizaBot.prototype.postExp=/####/,ElizaBot.prototype.posts["####"]="####";e.elizaQuits&&void 0!==elizaQuits.length||(elizaQuits=[]),ElizaBot.prototype._dataParsed=!0},ElizaBot.prototype._sortKeywords=function(e,t){return e[1]>t[1]?-1:e[1]<t[1]||e[3]>t[3]?1:e[3]<t[3]?-1:0},ElizaBot.prototype.transform=function(e){var t="";this.quit=!1;for(var i=(e=(e=(e=(e=(e=(e=e.toLowerCase()).replace(/@#\$%\^&\*\(\)_\+=~`\{\[\}\]\|:;<>\/\\\t/g," ")).replace(/\s+-+\s+/g,".")).replace(/\s*[,\.\?!;]+\s*/g,".")).replace(/\s*\bbut\b\s*/g,".")).replace(/\s{2,}/g," ")).split("."),s=0;s<i.length;s++){var r=i[s];if(""!=r){for(var o=0;o<elizaQuits.length;o++)if(elizaQuits[o]==r)return this.quit=!0,this.getFinal();var a=this.preExp.exec(r);if(a){for(var n="",l=r;a;)n+=l.substring(0,a.index)+this.pres[a[1]],l=l.substring(a.index+a[0].length),a=this.preExp.exec(l);r=n+l}this.sentence=r;for(var h=0;h<elizaKeywords.length;h++)if(r.search(new RegExp("\\b"+elizaKeywords[h][0]+"\\b","i"))>=0&&(t=this._execRule(h)),""!=t)return t}}""==(t=this._memGet())&&(this.sentence=" ",(h=this._getRuleIndexByKey("xnone"))>=0&&(t=this._execRule(h)));return""!=t?t:"I am at a loss for words."},ElizaBot.prototype._execRule=function(e){for(var t=elizaKeywords[e][2],i=/\(([0-9]+)\)/,s=0;s<t.length;s++){var r=this.sentence.match(t[s][0]);if(null!=r){var o=t[s][1],a=t[s][2],n=this.noRandom?0:Math.floor(Math.random()*o.length);this.noRandom&&this.lastchoice[e][s]>n||this.lastchoice[e][s]==n?(n=++this.lastchoice[e][s])>=o.length&&(n=0,this.lastchoice[e][s]=-1):this.lastchoice[e][s]=n;var l=o[n];if(this.debug&&alert("match:\nkey: "+elizaKeywords[e][0]+"\nrank: "+elizaKeywords[e][1]+"\ndecomp: "+t[s][0]+"\nreasmb: "+l+"\nmemflag: "+a),0==l.search("^goto ","i")&&(ki=this._getRuleIndexByKey(l.substring(5)),ki>=0))return this._execRule(ki);var h=i.exec(l);if(h){for(var p="",z=l;h;){var f=r[parseInt(h[1])],g=this.postExp.exec(f);if(g){for(var u="",c=f;g;)u+=c.substring(0,g.index)+this.posts[g[1]],c=c.substring(g.index+g[0].length),g=this.postExp.exec(c);f=u+c}p+=z.substring(0,h.index)+f,z=z.substring(h.index+h[0].length),h=i.exec(z)}l=p+z}if(l=this._postTransform(l),!a)return l;this._memSave(l)}}return""},ElizaBot.prototype._postTransform=function(e){if(e=(e=e.replace(/\s{2,}/g," ")).replace(/\s+\./g,"."),this.global.elizaPostTransforms&&elizaPostTransforms.length)for(var t=0;t<elizaPostTransforms.length;t+=2)e=e.replace(elizaPostTransforms[t],elizaPostTransforms[t+1]),elizaPostTransforms[t].lastIndex=0;if(this.capitalizeFirstLetter){var i=/^([a-z])/.exec(e);i&&(e=i[0].toUpperCase()+e.substring(1))}return e},ElizaBot.prototype._getRuleIndexByKey=function(e){for(var t=0;t<elizaKeywords.length;t++)if(elizaKeywords[t][0]==e)return t;return-1},ElizaBot.prototype._memSave=function(e){this.mem.push(e),this.mem.length>this.memSize&&this.mem.shift()},ElizaBot.prototype._memGet=function(){if(this.mem.length){if(this.noRandom)return this.mem.shift();for(var e=Math.floor(Math.random()*this.mem.length),t=this.mem[e],i=e+1;i<this.mem.length;i++)this.mem[i-1]=this.mem[i];return this.mem.length--,t}return""},ElizaBot.prototype.getFinal=function(){return ElizaBot.prototype.global.elizaFinals?elizaFinals[Math.floor(Math.random()*elizaFinals.length)]:""},ElizaBot.prototype.getInitial=function(){return ElizaBot.prototype.global.elizaInitials?elizaInitials[Math.floor(Math.random()*elizaInitials.length)]:""},void 0===Array.prototype.push&&(Array.prototype.push=function(e){return this[this.length]=e}),void 0===Array.prototype.shift&&(Array.prototype.shift=function(){if(0==this.length)return null;for(var e=this[0],t=1;t<this.length;t++)this[t-1]=this[t];return this.length--,e});